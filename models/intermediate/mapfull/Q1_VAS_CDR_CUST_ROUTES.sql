{{ set_model_config() }}

SELECT A.ACCESS_NUMBER AS ACCESS_NUMBER,
       MAX(A.CUSTOMER_POP) AS CUSTOMER_POP,
       MAX(A.PRODUCT) AS PRODUCT,
       B.CAL_DT AS CALL_DATE
FROM {{ref('VAS_CDR_CUSTOMER_ROUTES')}} A, {{ref('CALENDAR')}} B
WHERE 1=1
   AND B.CAL_DT IN (SELECT CALL_DT FROM {{ref('Q1_IBIS_CALL_MAPFULL_CCOM_RATING_SERVICES_FLAG')}} GROUP BY 1)
   AND B.CAL_DT BETWEEN A.START_DATE AND A.END_DATE
GROUP BY A.ACCESS_NUMBER,B.CAL_DT